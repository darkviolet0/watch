
<div class="container blog-page-container">
      <div class="row">
        <div id="blog-section" class="col-md-8 blog-section">

          <!-- Post Box-->
          <div class="row post-box">
              <article class="post-content">
                      <h2 class="section-title"><%= @site.location %></h2>
                      <p class="section-description"><%= @site.description %></p>
                      <div id="googleMaps" class="google-map-container"></div><!-- /#google-map-->
                <h2 class="post-title" style="color: black;">
                  <%= @track.name %>
                </h2>
                <p class="post-meta">
                  Nature : <%= @track.typology %> |
                  <% if @track.side %>
                    Côté : <%= @track.side %> 
                  <% end %>
                  
                  <% if @track.CycleTrackComment.length != 0 %>
                    Note moyenne : 
                   <% @track.CycleTrackComment.average(:rating).nil? ? avg_rating = 0 : avg_rating = @track.CycleTrackComment.average(:rating).round %>
                    <% count = count2 = 1 %>
                        <% while (count <=  avg_rating) %>
                          <%= image_tag("star-on.png", style: "width: 16px !important") %>
                          <% count += 1 %>
                        <% end %>
                        <%while (count2 <= (5 -  avg_rating)) %>
                          <%= image_tag("star-off.png", style: "width: 16px !important") %>
                          <% 
                          count2 += 1
                        end%>
                  <% end %>
                </p>
                <% if @track.CycleTrackComment.length != 0 %>
              <%= @track.CycleTrackComment.length %> commentaire(s)
            <% else %>
              Pas de commentaires.
            <% end %>
              </article> <!-- /.post-content -->
          </div><!-- /#post-box --><!-- /.row -->
          <!-- Post Box End -->

          <div class="comment-section" id="comments">
                  

                  <% @track.CycleTrackComment.each do |comment| %>
                        <div id="submited-comment">
                          <ol class="commentlist">
                            <li  class="comment">
                            <section id="comment-<%= comment.id %>">
                              <article>
                                <div class="author-image col-md-3">
                                  <img class="img-circle" src="<%= current_user.image %>?type=large" alt="Author Image"/>
                                </div><!-- /.author-hex -->

                                <div class="comment-content col-md-9">
                                  <p class="comment-meta">
                                    <%= current_user.name %> <br> 
                                    Le <%= l(comment.created_at, :format => '%d %B %Y') %>
                                  </p><!-- /.comment-meta -->
                                  <div id="star container">
                                  Note donnée à la portion: 
                                  <% count = count2 = 1 %>
                                    <% comment.rating.nil? ? rating = 0 : rating = comment.rating
                                    while (count <= rating) %>
                                      <%= image_tag("star-on.png", style: "width: 16px !important") %>
                                      <% count += 1 %>
                                    <% end %>
                                    <%while (count2 <= (5 - rating)) %>
                                      <%= image_tag("star-off.png", style: "width: 16px !important") %>
                                      <% 
                                      count2 += 1
                                    end
                                    %>
                                    </div> <!-- ./ star container -->
                                  <p><%= comment.text %></p>
                                  <p><a class="btn custom-btn angle-effect" href="#">Répondre</a></p>
                                </div><!-- /.comment-content -->
                                </section>                    
                              </article>
                            </li> <!-- /.comment -->
                           </ol> <!-- /.commentlist -->
                        </div> <!-- /#submited-commnet -->
                  <%end %>

            <!-- Leave Comment -->
           
            <h3 class="title">Laisser un commentaire</h3>

              <div id="respond">
                <form action="/cycle_track_comments" class="comment-form" method="post" id="commentform">
                  <%= current_user.name %> | <%= current_user.email %>  
                  <br>Notez le parcours : <br>
                  <span class="rating">
                          <input type="radio" class="rating-input" id="rating-input-1-5" name="rating" value="5" />
                          <label for="rating-input-1-5" class="rating-star"></label>
                          <input type="radio" class="rating-input" id="rating-input-1-4" name="rating" value="4" />
                          <label for="rating-input-1-4" class="rating-star"></label>
                          <input type="radio" class="rating-input" id="rating-input-1-3" name="rating" value="3" />
                          <label for="rating-input-1-3" class="rating-star"></label>
                          <input type="radio" class="rating-input" id="rating-input-1-2" name="rating" value="2" />
                          <label for="rating-input-1-2" class="rating-star"></label>
                          <input type="radio" class="rating-input"id="rating-input-1-1" name="rating" value="1" />
                          <label for="rating-input-1-1" class="rating-star"></label>
                  </span>
                  <%= tag(:input, :type => "hidden", :name => request_forgery_protection_token.to_s, :value => form_authenticity_token) %> 
                  <%= tag(:input, :type => "hidden", :name => "track_id", :value => @track.id) %> 
                  <%= tag(:input, :type => "hidden", :name => "id_site", :value => @site.id) %> 
                  <textarea class="form-control" id="comment" name="comment" placeholder="Message" rows="8" required></textarea>
                  <input name="submit" type="submit" id="submit" value="Poster" class="btn">
                </form><!-- /#commentform -->
              </div><!-- /#respond -->
         
            <!-- Leave Comment End -->
          </div><!-- /#comments -->
        </div><!-- /#blog-section --> 

<!-- SIDEBAR -------------------------------------------->

        <aside id="blog-sidebar" class="col-md-4 blog-sidebar">
            <h3 class="title">
             Laissez votre avis !
            </h3>
            <p class="widget-content">
              Vous pouvez sélectionner une portion dans la liste déroulante ou effectuer une recherche, pour chaque portion vous pouvez noter et commenter votre expérience personnelle.
            </p><!-- /.widget-content -->
          <!-- cycle tracks elements list -->
                <select id= "track_select" class="form-control inputstl" style="width: 100%" onchange="">
                  <% cycle_tracks = CycleTrack.all  
                  cycle_tracks.each do |ct| %>
                    <option value="<%= ct.id %>"><%= ct.name.to_s + " - " + ct.typology.to_s %></option>
                  <% end %>
                </select>
          <!-- /.cycle tracks elements list --> 
          <p class="widget-content">
              ou
            </p><!-- /.widget-content -->
          
        <%= form_tag("/searchct", id: "search-form", method: "get", remote: true, class: "sidebar-search  clearfix") do %>
          <input class="form-control" type="text" name="search" id="search" placeholder="Trouver une portion" required>
          <button class="btn"><i class="fa fa-search"></i></button>
        <% end %>

         <div id="searchdisplay" name="searchdisplay"></div>

        </aside><!-- /#blog-sidebar -->   
      </div> <!-- /.row -->
    </div><!-- /.container -->


<script>
$('#track_select').change(function() {
  window.location = "?track_id=" + $(this).val();
});


// Search form.
  $('#search-form input').keyup(function () {
      if (document.getElementById("search").value.length < 4) return;
      $.get($("#search-form").attr("action"), $(this).serialize(), null, 'script');
      return false;
  });



  
</script>
     
<script type="text/javascript">
      /*----------- Google Map -  ----------------*/
        function initMap() {
            var mapDiv = document.getElementById('googleMaps');
            var map = new google.maps.Map(mapDiv, {
                center: {lat: <%= @track.lat %>, lng: <%= @track.long %>},
                zoom: 15,
                mapTypeControl: true,
                mapTypeControlOptions: {
                  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
                },
                navigationControl: true,
                scrollwheel: false,
                streetViewControl: true
            });

            var <%= "chris"+@track.id.to_s %> = new google.maps.Marker({
                position: {lat: <%= @track.lat %>, lng: <%= @track.long %>},
                map: map
            });
            
          }
            
            function isMobile() { 
              return ('ontouchstart' in document.documentElement);
            }
        

              if (isMobile()) {
                options.draggable = false;
              }


            initMap();
   
</script>